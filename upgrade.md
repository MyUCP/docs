# Руководство по обновлению

- [Обновление до 5.7 с 5.6](#Обновление-до-5.7-с-5.6)

<a name="Обновление-до-5.7-с-5.6"></a>
## Обновление до 5.7 с 5.6

#### Предполагаемое время обновления: около 15 минут

> **Примечание:** постарались описать все критичные изменения которые могут навредить работе приложения. После проведения обновления ошибок возникнуть не должно.

### Обновление файлов

В первую очередь стоит загрузить обновленные файлы с официального репозитория.
Для начала стоит обновить папку `engine` и полностью заменить содержимое директории `engine/protected`. Так же стоит заменить
файлы `app.php` и `core.php` которые лежат в папке `engine`.

После чего стоит переместить все содержимое из директории `theme` в новую директорию шаблонов `resources/views`.

Стоит обновить файл `index.php` в котором указаны константы с новыми путями к директориям.

В `app/services` стоит добавить новые сервисы и заменить существующий `ZaraService`, если в нем были прописаны директивы и другой код, его стоит переместить в новый файл сервиса.

Нужно создать новую директорию `extensions` и переместить в ту расширения из репозитория или оставить пустой если таких нет.

Стоит создать файл окружения `.env` и задать параметры для работы приложения, пример указан в файле `.env.example`.

Нужно обновить главный конфигурационный файл `configs/main.php` указав данные для некоторых параметров из файла окружения, а так же указать массив с расширениями,
если таковых нет, оставить массив пустым.

### Контейнер

Если вы раньше использовали метод `make()` контейнера `Application` для определения существования объекта в контейнер
то сейчас рекомендуется использовать метод `has()` который будет возвращать логическое значение.

Если вы где-то использовали экземпляр класса `Registry` для получения данных из контейнера, стоит заменить тот на `Application` для поддержки алиасов и новых методов.

### Сессия

Если у вас в коде где-то использовалась конструкция с указанием нового значения через помощник `session()`, то сейчас вторым аргументом
помощник получает значение которое будет возвращено по умолчанию если оно не установлено, для установки значения через помощник следует вызвать метод `put()` 
класса `Session` который возвращаеться если не указывать аргументы помощнику:

```php
session('user_id', '3'); // Старый вариант

session()->put('user_id', '3'); // Новый вариант
``` 

Так же если вы использовали метод `get()` как и функцию помощник то стоит заменить этот метод на метод `put()`.

### Исключения

Если раньше вы использовали где-то вызов дебаггера при помощи класса `Debug` просто его созданием, сейчас вы 
можете использовать выбрасывание исключений при помощи класса `DebugException`:

```php
new Debug('Ошибка!'); // Старый вариант

throw new DebugException('Ошибка!'); // Новый вариант
```

Обязательно стоит создать шаблон **500** ошибки в шаблонах или взять страницу из репозитория. В случае если не будет найден шаблон для
других кодов ошибок будет вызвана 500 страница или если включен дебаг мод то будет показана страница с информацией об исключении.

### Название моделей

Раньше нужно было указывать к названию класса обязательное слово `Model` и при этом не указывать его в названии файла, сейчас это требование
убрано и теперь это делать не обязательно, название класса и файла может совпадать. Старый вариант так же согласно политике поддержкий версий будет доступен в этой версии.

### Генератор ссылок

Если раньше при генерации адреса вы указывали перед ним ваш адрес сайта то теперь стоит это убрать, генератор автоматически подставляет адрес сайта из конфигурационного файла.
Если же вы написали слишком много кода с использованием такого метода, то вы можете просто в конфигурационном файле убрать ваш адрес сайта.

### Загрузка файлов

Если раньше вы использовали загрузку файлов, и использовали метод `file` для простого доступа к массиву данных файла, то теперь
этот метод возвращает объект класса `File`, стоит заменить работу данных.

Если было загружено несколько файлов то будет возвращен массив с файлами.

```php
$file = Request::file('avatar');

$file->save();
```

```php
$files = Request::file('images');

foreach($files as $file) {
    $file->save();
}
```

Теперь вы можете проверить загружен ли файл при помощи метода `hasFile()`.