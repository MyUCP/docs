# Запросы

- [Введение](#Введение)
- [Получение данных](#Получение-данных)
- [Методы запроса](#Методы-запроса)
    - [Тело запроса](#Тело-запроса)
	- [Метод запроса](#Метод-запроса)
	- [Домен, хост и тип](#Домен-хост-и-тип)
	- [Формат и тип запроса](#Формат-и-тип-запроса)
	- [Путь, текущий адрес](#Путь-текущий-адрес)
	- [Текущий маршрут](#Текущий-маршрут)
	- [Данные пользователя](#Данные-пользователя)
	- [Ajax](#Ajax)
- [Cookie](#Cookie)
- [Файлы](#File)
     - [Получение файла](#Получение-файла)
     - [Сохранение файла](#Сохранение-файла)

<a name="Введение"></a>
## Введение

Для работы вашего приложения используется HTTP запрос для обработки которого был построен модуль запросов <code>Request</code>
это класс который имеет возможность фильтровать некоторые данные и дает возможность вам получить информацию о
текущем запросе.

Получить доступ к объекту <code>Request</code> вы можете при помощи главного объекта <code>Application</code>
или при помощи функции <code>request()</code>.

<a name="Получение-данных"></a>
## Получение данных

Когда вы принимаете запрос вам отправляются данные, модуль запросов умеет обрабатывать их и фильтровать таким
образом что бы их обезопасить.

Все данные которые вы получаете при помощи объекта <code>Request</code> уже идут отфильтрованными, если подключена
база данных то они так же и проходят проверку для базы данных, и готовыми для записи или проверки.

Для получения отправленных данных существует несколько методов, которые доступны только статически. Если 
вы хотите получить доступ к этим данным непосредственно через объект, вам нужно использовать функцию-помощник
<code>request()</code> или главный объект <code>Application</code>.

```php
$name = request()->post['name'];
$name = request()->post->get('name', 'Elon'); // Таким образом можно указать значение по умолчанию
$name = Request::post('name', 'Elon'); // Так же можно указать значение по умолчанию
```

Выше указан пример получения имени которое было отправленно при помощи POST запроса, но если вы не знаете
какой запрос был вам отправлен, вы можете использовать метод <code>input</code> который даст вам возможность получать
данные из всех типов запросов и так же указать значение по умолчанию:

```php
Request::input('name'); // Уже не зависит от типа запроса
```

Так же для упрощения работы был добавлен метод <code>::exists()</code> который проверяет на существование
в массиве данных указанного вами ключа, таким образом вы можете проверять пришли ли те или инные данные и совершать
нужные вам действия.

```php
if(Request::exists('name')) {
	$name = Request::input('name');
}

// Или можно указать значение по умолчанию
$name = Request::input('name', 'Elon');
```

Ниже вы можете увидеть доступные методы для получения необходимых данных:

```php
Request::post($name, $default = null);
Request::get($name, $default = null);
Request::server($name, $default = null);
Request::file($name);
Request::cookie($name, $value = null, $time = null);
Request::input($key = null, $defaults = null);
Request::all(); // Позволяет получить коллекцию всех данных вместе
```

<a name="Методы-запроса"></a>
## Методы запроса

Помимо получения данных вы можете получить и другие сведения о запросе, например текущий адрес, хост или IP адрес
пользователя. Эти методы помимо методов получения данных уже доступны только с объекта <code>Request</code>
они не доступны через статический метод.

<a name="Тело-запроса"></a>
### Тело запроса

Иногда запрос может быть в виде какого то большего объема данных, для этого вы можете использовать метод
<code>getContent($asResource = false)</code> что бы получить его.

```php
request()->getContent();
```

<a name="Метод-запроса"></a>
### Метод запроса
Вы можете получить текущий метод запроса при помощи которого он был выполнен:

```php
$method = request()->method();
$method = app('request')->method(); // Альтернативный способ
```

Но в примере выше вы получите метод с учетом использования методов <code>PUT</code>, <code>DELETE</code> и подобных,
для того что бы получить "реальный" метод необходимо использовать <code>getMethod()</code>. Так же вы можете проверить
действительно ли текущий метод это тот что вам нужен, просто использую метод <code>isMethod($name)</code>. Или вы можете
проверить безопасный ли текущий метод <code>isMethodSafe()</code>.

```php
$method = request()->getMethod(); // Если method() вернет DELETE, это этот вариант вернет POST

if(request()->isMethod("POST")) {
	//
}

if(request()->isMethodSafe()) {
	//
}
```

<a name="Домен-хост-и-тип"></a>
### Домен, хост и тип

Вы так же можете получить текущий домен и хост, иногда это одно и тоже, но если запрос происходит с использованием
нестандартного порта, вы можете его так же получить.

```php
$domain = request()->domain();
$host = request()->getHttpHost(); // Тут вы уже получите хост с портом (хост:порт) если он не стандартный (80 или 443)
$port = request()->getPort(); // Просто порт
```

Вы так же можете получить тип соедениня (HTTP или HTTPS) или так же полный адрес учитывая хост:

```php
$domain = request()->getSchemeAndHttpHost();

request()->getScheme(); // Вернет просто тип соединения (http или https)
request()->isSecure(); // Вернет true если текущее соединение безопасно
```

<a name="Формат-и-тип-запроса"></a>
### Формат и тип запроса

Вы можете получить формат запроса если он указан при помощи атрибута <code>_format</code> и тип при помощи метода
<code>getMimeType($format)</code>

```php
request()->getMimeType(request()->getRequestFormat());
```

<a name="Путь-текущий-адрес"></a>
### Путь, текущий адрес

Вы можете получить текущий адрес по которому происходит выполнение запроса или часть пути которая вам нужна.

```php
 // Для примера, адрес запроса: http://myapp.com/user?id=1

request()->getBaseUrl(); //
request()->getUri(); // http://myapp.com/user?id=1
request()->getRequestUri(); // /user?id=1
request()->getPathInfo(); // /user
request()->path(); // user
request()->decodedPath(); // user
```

<a name="Текущий-маршрут"></a>
### Текущий маршрут

Вы можете получить текущий маршрут который был обработан.

```php
Request::route();
request()->getRoute();
```

В обоих случаях будет возвращен экземпляр класса `Route`. Методы идентичны функции-помощнику <a href="/docs/5.7/route">`route()`</a>

<a name="Данные-пользователя"></a>
### Данные пользователя

Вы можете получить бразуер пользователя (UserAgent) и его IP адрес.

```php
$browser = request()->userAgent();
$ip = Request::ip();
```

<a name="Ajax"></a>
### Ajax

Для того что бы определить исползует ли текущий запрос AJAX вы можете использовать следующие методы:

```php
request()->isXmlHttpRequest();

Request::ajax();
```

<a name="Cookie"></a>
## Cookie

Для получения COOKIE вы можете использовать метод <code>cookie()</code> аргументом которой выступает название куки, вторым аргументом функция принимает значение куки (будет перезаписано если кука уже существует), третьим аргументом принимает время жизни. 
В качестве результата вы получите объект <code>Cookie</code> или данные если вы не указывали других аргументов кроме ключа, если вы указали второй аргумент то результатом будет установление значения куки. 
Как альтернативу вы можете использовать глобальную функцию <code>cookie()</code>.

```php
Request::cookie("token"); //Вы получите значение куки token
Request::cookie("token", "elon", 60); // Куки token будет установлено значение elon с временем жизни час. 
```

Если вам необходимо установить "вечную" куку то вы можете использовать метод <code>forever()</code>.

```php
Request::cookie("token", "elon")->forever(); // "На самом деле нет". Время жизни "вечной" куки - 5 лет.
```

<a name="File"></a>
## Файлы
<a name="Получение-файла"></a>
## Получение файла

При загрузке файлов все входные данные о них обрабатываются, и оборачиваются в объект `File`, он имеет ряд методов для работы с файлом.

Если вы хотите получить объект файла вы можете воспользоваться методов `file($name)`:

```php
$file = Request::file('image');
```

Но если вы дали возможность пользователю загрузать несколько файлов одновременно, вы можете обращаюсь по названию поля, указывать индексы для доступа к файлам:

```php
$files = Request::file('images');

//
echo $files[0]->getOriginalName() // Указываем иденкс файла, получим название файла.

// Вы можете перебрать файлы в цикле
foreach($files as $file) {
    echo $file->getOriginalName();
}
```

Вы так же можете проверить были ли отправлены файлы и существует ли такое поле:

```php
if(Request::hasFile('images')) {
    //
}
```

> Стоит учесть что если вы пытаетесь получить файл через `Request::input()` то он будет возвращен так же в виде объекта.

Вы можете получить больше информации о файле из объекта `File` при помощи методов которые указаны ниже:

```php
Request::file("photo")->getExtension(); // Вы получите расширение файла
Request::file("photo")->getMd5(); // Вы получите md5-хэш файла
Request::file("photo")->getTmpPath(); // Вы получите полный путь к временному файлу на сервере
Request::file("photo")->getPath(); // Вы получите путь к временному файлу на сервере без указания самого файла в конце
Request::file("photo")->getError(); // Вы получите код ошибку
Request::file("photo")->getMimeType(); // Вы получите тип файла
Request::file("photo")->getSize(); // Вы получите размер файла
Request::file("photo")->getOriginalName(); // Вы получите оригинальное название файла
```

Если файл не был загружен, будет выброшено исключение `UploadException` которое будет иметь в себе текст ошибки и код.

<a name="Сохранение-файла"></a>
## Сохранение файла

Для удобства работы с файлами вы можете их сохранять сразу после загрузки, это возможно при помощи объекта `File` в который оборачивается
каждый загруженный файл.

Метод `move()` позволит вам сохранить файл в нужно вам место, метод возвращает `false` если файл не удалось сохранить или `путь` по которому
был сохранен файл.

```php
$path = $file->move();
```

Вы так же можете указать сами куда нужно сохранить файл, указав путь в качестве первого аргумента:

```php
$path = $file->move(app()->assetsPath('images')); // /assets/images/{filename}
```

Вы так же можете указать название файла под которым его нужно сохранить, если этого не делать, как в примерах выше, название файла будет
его `md5` хэшем и с расширением в конце, но если вы хотите указать свое имя файлу, вы можете это сделать передав его в качестве второго аргумента.

```php
$path = $file->move(app()->assetsPath('images'), 'filename.jpg');  // /assets/images/filename.jpg
```

> Если не указывать путь сохранения файлов они будут автоматически сохранятся по пути `/assets/files/`

Так же существует еще один метод `save()` который полностью идентичен методу `move()` и является его алиасом.