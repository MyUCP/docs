# Версии фреймворка

- [Политика поддержки старых версий](#Политика-поддержки-старых-версий)
- [MyUCP 5.6](#5.6)
- [MyUCP 5.5](#5.5)
- [MyUCP 5.4](#5.4)
- [MyUCP 5.3](#5.3)
- [MyUCP 5.2](#5.2)
- [MyUCP 5.1](#5.1)

<a name="Политика-поддержки-старых-версий"></a>
## Политика поддержки старых версий

Поддержка старых версий не производиться, а это значит что новая версия фреймворка есть самой актуальной и стоит использовать именно её. Если выходит более глобальное обновление то новая версия может содержать методы которые были в ней заменены / убраны но при этом использовались в предыдущей версии. Тем самым некоторые функции могут быть доступны ещё около 2-ух версий после обновления.

<a name="5.6"></a>
## MyUCP 5.6

Полностью переписан модуль запросов `Request`.
<hr>

Полностью переписан модуль ответов `Response`.
<hr>

Полностью переписан модуль маршрутизации.
<hr>

Исправлены и обновленны Cookies, теперь их работа стабильна и они работают как нужно. Исправленны "двойные" куки, когда одна кука повторялась
и при получении значения куки она перезаписывалась, тем самым значения не сохранялись должным образом.
<hr>

Полность изменен принцип работы ядра, теперь есть единый класс `Application`
который отвечает за инициализацию всех основных классов и запуск приложения. Так же он используеться
как контейнер (Registry), поэтому изменений в вашем приложении делать не нужно.
<hr>

Добавлена возможность работать без базы данных. Если вы не планируете использовать базу данных,
вы можете её отключить, заккоментировав блок `db` в главном конфигурационном файле.
<hr>

Добавлен генератор URL адресов, для него создана специальная функция-помощник `url()`.
<hr>

Метод `getRedirectUrl()` в классе `RouteHelper` убрана, так же как и сам класс. Теперь
вы можете использовать функцию `redirect_url()` или генератор адресов для получения адреса.
<hr>

В шаблонизаторе Zara добавлена возможность добавлять свои директивы.
<hr>

С обновлением модуля маршрутизации добавлен новый тип групп по имени, по условию. В результате были убраны старые
системы создания групп и изменены на болие удобные.
<hr>

Помимо стандартных методов получения данных, добавлен универсальный `input()` и метод для получения всех
данных `all()`
<hr>

Для локализации добавлен новый метод для получения текущего языка `Lang::currentLocale()`.
<hr>



<a name="5.5"></a>
## MyUCP 5.5

Исправлена проблема с конструктором запросов, когда метод `where` и ему подобные неверно обрабатывали значение.
<hr>

Исправлена проблема когда метод `where` и ему подобные принимая в качестве третьего аргумента `0` воспринимали это за пустой аргумент и обрабатывали событие с двумя аргументами.
<hr>

Исправлена проблема при компилировании дополнительных шаблонов `Zara` при помощи функции `extends()`
<hr>

Исправлена проблема с методом `set()` конструктора запросов, когда при работе с ним через модель, передавая ему массив, он обрабатывал его неверно и брал только одно значение.
<hr>

Убран неиспользуемый файл и метод: `Document`
<hr>

Ряд файлов были перенесены в свои отдельные директории, а так же переименованы так, что бы название файла соответствовало названию класса.
<hr>

Исправлены проблемы с такими помощниками как: `redirect()` и `inject()`
<hr>

Так же, начиная с версии **5.5** вы можете указать `callback` функцию которая будет вызвана при переходе на адрес правила. `Callback` функция может быть указан вторым или третьим параметром, но в случае если она указана, то вызов метода контроллера уже не производится.
```php
Router::get("/", function() {
	return view("welcome");
});
```
<hr>

С главного конфигурационного файла был убран массив `mail`
<hr>

Добавлена возможность загружать пользовательские файлы для добавления в них своих собственных функций.
Для загрузки своих файлов вы можете указать их в специальном массиве (`load_files`) главного конфигурационного файла `main.php` и тем самым при инициализации конфигурационного файла они будут загружены.
```php
...
'load_files'          =>      [
    "app/helpers/SomeFunctions.php",
],
...

```
Добавлен новый помощник `session()`
Функция для получения значения сессии:

```php
session("user_id")
```

Если в качестве второго аргумента указать какое то значение, то оно будет заданно для текущей сессии или будет создано.

```php
session("user_login", "elon")
```
<hr>

Добавлена система <a href="/docs/5.5/localization">локализации</a> которая поможет в создании мультиязычности вашего сайта.
Так же вместе с этой системой был добавлен новый помощник `lang()`
Это которткий способ вызова метода `Lang::get`

```php
lang("profile/settings.login")
```

Подробнее об объекте `Lang` можно прочитать в разделе <a href="/docs/5.5/localization">Локализация</a>
<hr>

Исправлены сообщения об ошибке в конструкторе запросов, в таких методах как: `whereBetween`, `whereNotBetween`, `whereIn`, `whereNotIn`
<hr>

Исправлена проблема с добавление дополнительных заголовков при HTTP ответе пользователю.
<hr>

Убраны устарелые методы класса `Controller`: `extends`, `extendsView`

Добавлена групировка роутов, теперь вы можете группировать их по трем основным параметрам. Подробнее в разделе <a href="/docs/5.5/routing#Группы роутов">маршрутизации</a>.

Новые методы для создания роутов `alias` и `models`. Подробнее в разделе <a href="/docs/5.5/routing#Группы роутов">маршрутизации</a>.

Функция-помощник `route()` теперь возвращает экземпляр класса `RouteHelper`
<hr>


Изменилась работа с сессиями, теперь если обратится к экземпляру класса через объект `Registry` то вы сможете обратится к разным новым методам для работы с сессиями. Подробнее в новом разделе <a href="/docs/5.5/session">Session</a>.
<hr>


Изменена функция-помощник `redirect()`, теперь у неё свой класс `Redirect` который так же имеет несколько полезных методов. Подробнее в разделе <a href="/docs/5.5/response">Response</a>.
<hr>


Исправлена ошибка при работе с методом `select` <a href="/docs/5.5/builder">конструктора запросов</a>.
<hr>


Добавлен новый метод `escape` в объект `db`, который экранирует данные для запроса SQL. Так же данный метод внедрен в класс `Request` и все входящие данные проходят ещё одну проверку.
<hr>


Исправлена проблема с распознаванием адресов роутинга.

<a name="5.4"></a>
## MyUCP 5.4

Исправлена ошибка компилирования шаблонов
<hr>

Для добавления в автозагрузку своих классов теперь можно использовать файл `autoload_classes.php` в папке `configs`, он будет дополнять общий файл. Теперь после каждого обновления не обязательно редактировать основной файл.
<hr>

В главном конфиге (`main.php`) добавлен новый параметр key который служит ключем (солью) для шифрования данных.
<hr>

Добавлены две новые глобальные функции: cookie и config.
<a name="config()"></a>
### config()

Функция для получения объекта `Config`:

<div class="highlight highlight-text-html-php">```php
<span class="pl-s1">config()<span class="pl-k">-&gt;</span><span class="pl-smi">url</span>;</span>
```</div>

Подробнее об объекте `Config` можно прочитать в разделе <a href="/docs/5.4/configs">Configs</a>

<a name="cookie()"></a>
### cookie()

Функция для получения объекта `Cookie`:

```php
cookie("token");
```

Подробнее об объекте `Cookie` можно прочитать в разделе <a href="/docs/5.4/requests">Requests</a>
<hr>

Обновлён класс для работы с входящими данными (Request). Так же были добавлены методы для работы с файлами (загруженными) и куками. Подробнее можно узнать в разделе <a href="/docs/5.4/request">Request</a>

Для метода Request добавлены новые функции: get(), post(), server, cookie, server, file.

<a name="GET"></a>
### GET

Для получения GET данных вы можете использовать новый метод `get()` аргументом которой есть ключ данных, функция вернёт вам массив данных или значение. 

```php
<?php

class HomeController extends Controller
{
  //Получить значение login в адресе http://myucp/?login=elon
  public function index()
  {
    return Request::get(&quot;login&quot;); //Будет выведено elon
  }
}
```

<a name="POST"></a>
### POST

Для получения POST данных вы можете использовать новый метод`post()` аргументом которой есть ключ данных, функция вернёт вам массив данных или значение. 

```php
<?php

class HomeController extends Controller
{
  //Получить значение login с формы
  public function index()
  {
    return Request::post(&quot;login&quot;); //Будет выведено значение поля
  }
}
```

<a name="COOKIE"></a>
### COOKIE

Для получения COOKIE вы можете использовать метод `cookie()` аргументом которой выступает название куки, вторым аргументом функция принимает значение куки (будет перезаписано если кука уже существует), третьим аргументом принимает время жизни. В качестве результата вы получите объект `Cookie`, если вы указали второй аргумент то результатом будет результат установления значения куки. Как альтернативу вы можете использовать глобальную функцию `cookie()`.

```php
Request::cookie("token")->getValue(); //Вы получите значение куки token
Request::cookie("token", "elon", time() + 3600); //Куке token будет установлено значение elon с временем жизни час. 
```

Все куки которые устанавливает MyUCP устанавливаются в зашифрованном виде, тем самым обычное получение значения выведет вам результат в зашифрованном виде, если вы до этого установили куку вы можете получить её при помощи метода `unHashed()`.

```php
Request::cookie("token")->unHashed(); //Вы получите "чистую" куку
```

Если вам необходимо установить "вечную" куку то вы можете использовать метод `forever()`.

```php
Request::cookie("token", "elon")->forever(); //"На самом деле нет". Время жизни "вечной" куки - 5 лет.
```

<a name="FILE"></a>
### FILE

Для получения одного файла из массива принятых файлов `$_FILES` вы можете использовать метод `file()` аргументом которой выступает название поля. В качестве результата вы получите объект `File`. Вы можете получить разного рода информация о файле:

```php
Request::file("photo")->getExtension(); //Вы получите расширение файла
Request::file("photo")->getMd5(); //Вы получите md5-хэш файла
Request::file("photo")->getTmpPath(); //Вы получите полный путь к временному файлу на сервере
Request::file("photo")->getPath(); //Вы получите путь к временному файлу на сервере без указания самого файла в конце
Request::file("photo")->getError(); //Вы получите код ошибку
Request::file("photo")->getMimeType(); //Вы получите тип файла
Request::file("photo")->getSize(); //Вы получите размер файла
Request::file("photo")->getOriginalName(); //Вы получите оригинальное название файла
```

Вы так же можете сохранить загруженный файл при помощи метода `move()`, в качестве первого аргумента принимает путь куда будет помещён файл, если путь не указан файл будет помещён в директорию `assets/files`. В качестве второго аргумента принимает название файла под которым будет сохранен файл, если аргумент не указан название файла будет обернуто в `md5()` и сохранено с оригинальным расширением.

```php
Request::file("photo")->move(); //Файл будет перемещён в директорию "assets/files", название файла будет обернуто в "md5()"
Request::file("photo")->move("/assets/media/", "logo.png"); //Файл будет перемещён в директорию "assets/media", название файла будет "logo.png"
```


<a name="5.3"></a>
## MyUCP 5.3

Обновлёна система маршрутизации, теперь нет необходимости заполнять массив с маршрутами, вы можете использовать специальные функции для создания маршрутов, так же теперь вы можете отделить типы запросов на GET и POST.

Вы можете разделить запросы которые будут приходить на ваш сайт на типы **GET** и **POST** тем самым это упростит работу например при использовании ajax, вам не нужно будет проводить лишние проверки на тип запроса.

Для создания нового правила в файле `routers.php` необходимо с новой строки прописать новый метод при помощи фасада `Router`:

```php
Router::get("/", "HomeController@welcome"); // Вызовет метод welcome контроллера HomeController при обычном GET запросе
Router::post("/", "HomeController@welcomePost");  // Вызовет метод welcomePost контроллера HomeController при обычном POST запросе
```

Как мы можем заметить метод `get()` как и метод `post()` принимают два параметра, первый параметр это сам URL, второй параметр вы можете указать как строку передав контроллер и метод которые вы хотите вызвать при переходе на данный адрес. 

Если указать второй параметр как массив то он должен иметь два значения: <em>as</em> и <em>uses</em>, первый из которых придаст имя маршруту, второй укажет какой метод вы хотите вызвать при переходе на указанный вами адрес в первом параметре.

```php
Router::get("/", ["as" => "home", "uses" => "HomeController@welcome"]);
```

<hr>


Перемещены некоторые файлы в директории для дальнейшей модификации системы автозагрузки.
<hr>


В хелперы были добавлены новые функции которые помогут вам работать с фреймворком удобнее

<a name="redirect()"></a>

### redirect()

Удобная функция для совершения переадресаций на желаемый вами адрес. В качестве аргумента просто укажите адрес:

```php
redirect('/login');
```

Вы так же можете передать, в качестве аргумента, метод `route()`, указав в качестве его метода название одного из маршрутов, функция осуществит переадресация по указанному вами маршруту.

```php
redirect(route('user.login'));
```

<a name="refresh()"></a>

### refresh()

Функция для того что произвести обновление страницы, очень удобно после использования POST запроса для предотвращения повторной отправки формы.

<a name="inject()"></a>

### inject()

Функция которая позволяет подключать любой класс в вашем контроллере, моделе. В качестве первого аргумента укажите переменную в которую будет помещен объект класса, в качестве второй укажите название класса. Предварительно необходимо прописать путь к загрузке класса в файле `configs/autoload_classes.php`.

```php
inject('test', 'Test');

$this->test; // Объект класса
```

> Обратите внимание при загрузке класса в качестве параметра ему будет передан объект `registry` который содержит в себе все методы фреймворка.

<hr>


Исправлена ошибка с пустым описанием ошибки при выходе ошибки PHP.
<hr>


Теперь маршрутизатор верно обрабатывает домашний URL (/)
<hr>


Создан Builder для облегчения работы с базой данных, вы можете создавать запрос используя функции. Как работать с конструктором запросов описано в статье <a href="/docs/5.4/builder">Конструктор запросов</a>.
<hr>


Добавлены две новые функции для работы с базой данных: `concat()` и `raw()`
<hr>


Исправлены проблемы которые встретились при работе и и перехода на новую версию после последнего обновления.
<hr>


Добавлен новый метод для маршрутизации `any()`
<hr>


Добавлены HTTP исключения
<hr>


Исправлена ошибка с использованием orWhere()
<hr>


<a name="5.2"></a>
## MyUCP 5.2

Добавлен <a href="/docs/5.4/zara">шаблонизатор Zara</a>
<hr>


Добавлена папка cache в папке временных файлов.
<hr>


Папка временных файлов (assets) была почищена от лишних файлов
<hr>


Добавлена возможность подключать несколько моделей / библиотек одновременно через функцию `model()` / `library()` просто указывая их через запятую.
<hr>


Исправлены ошибки с большим количеством запросов при помощи модели.
<hr>


Исправлена ошибка компилятора когда он не распознавал оператор `else`
<hr>


Добавлена новая функция code{inject()}

<a name="inject()"></a>
### inject()

Функция которая позволяет подключать любой класс в вашем контроллере, моделе. В качестве первого аргумента укажите переменную в которую будет помещен объект класса, в качестве второй укажите название класса. Предварительно необходимо прописать путь к загрузке класса в файле `configs/autoload_classes.php`.

```php
inject('test', 'Test');

$this->test; //Объект класса
```

> Обратите внимание при загрузке класса в качестве параметра ему будет передан объект `registry` который содержит в себе все методы фреймворка.

<hr>


Исправлено множество ошибок с дебагером.
<hr>


Добавлена функция `ci()` для вывода всех функций из класса.
<a name="ci()"></a>
### ci()

Отчасти функция схожа с функцией `dd()`, но только данная функция выводит на страницу все доступные методы указанного вами класса.
<hr>


Все функции: `dd()`, `ci()` выведены в отдельный файл.
<hr>


Добавлен файл `Dumper` для дополнения новыми функциями-помощниками.
<hr>


Добавлен параметр `callback` для вызова кода при выполнении правила роутинга.
<hr>


Исправлена работа функции `where()`.
<hr>


<a name="5.1"></a>
## MyUCP 5.1

Добавлены функции для упрощения работы с базой данных и моделями (<a href="/docs/5.4/database">Подробнее</a>).
<hr>


Добавлен режим откладки который поможет вам решать некоторые проблемы которые могут возникнуть при разработке, после завершения разработки рекомендуется его отключать (в главном конфиге).
<hr>


Оптимизировано ядро фреймворка, функция `dd()` перенесена в раздел файлов дебаг модуля
<hr>


Исправлены ошибки при работе (особенно подключением) с базой данных.
<hr>


При помощи класса `Debug()` вы сами можете вызвать ошибку дебагера в нужных местах.
<hr>


Исправлен баг при загрузке нескольких конфигов, когда загружался только один дополнительный и основной.
<hr>


Исправлен баг когда невидима функция `dd()`, временно перемещена в `app.php`