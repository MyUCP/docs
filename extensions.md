# Расширения

- [Вступление](#Вступление)
- [Создание расширения](#Создание-расширения)
    - [Доступные методы](#Доступные-методы)
    - [Инициализируемые расширения](#Инициализируемые-расширения)
- [Вызов расширения](#Вызов-расширения)
    - [Пересоздание расширения](#Пересоздание-расширения)
- [Методы помощники](#Методы-помощники)
    
<a name="Вступление"></a>
## Вступление

В последней версии MyUCP появилась возможность создавать свои расширения, она пришла на замену старой системе библиотек, которая по сути была просто системой
загрузки файла какого-то класса из опеределенной директории.

Система расширений это определенная структура работы некоторых модулей которые должны работать по отдельности.

Все расширения хранятся в директории `extensions`.

Вы можете загрузить уже готовые расширения:

- [Авторизация](#https://github.com/MyUCP/Extension.Auth) - система авторизации и регистрации.
- [Валидация](#https://github.com/MyUCP/Extension.Validate) - расширение для валидации разных данных.

<a name="Создание-расширения"></a>
## Создание расширения

Для создания расширения следует создать директорию для нашего расширения, к примеру наше расширение будет называться `Test`.

После создания директории нам нужно создать основной класс с которым мы будем работать. Для более простого понимания другими разработчиками принято создлавать основной класс с таким же названием
как название расширения или директории, то есть наше расширение называется `Test`, тогда наш файл с классом будет называться `Test.php`.

В результате мы будем иметь такую структуру:

```
- extensions/
    - Test/
        Test.php
```

Теперь нам нужно создать класс в файле, название его должно совпадать с названием файла, так же стоит указать пространство имён, но если
вы не укажете пространство имён, то вам нужно будет вручную указать путь к автозагрузке классов в файле `configs/autoload_classes.php`.

Стоит учесть что класс расширения должен обязательно наследовать класс `\MyUCP\Extension\BaseExtension` для идентефикации класса как класс расширения.

```php
<?php

namespace Extensions\Test;

use MyUCP\Extension\BaseExtension;

class Test extends BaseExtension
{
    public function __construct(\Application $app, ...$args)
    {
        parent::__construct($app);
        
        //
    }

    public function run(...$args)
    {
        //
    }
}
```

При создании класса в его конструктор будет передан экземпляр класса `Application`, следующие аргументы будут переданы опционально, если они были
переданы при вызове расширения.

#### Указание расширения

После создания основного класса нам нужно указать расширение в список расширений, для того что бы при вызове расширения мы могли его инициализировать.

В файле `configs/main.php` в массиве `extensions` стоить добавить новую строчку в виде `название расширения => основной класс`:

```php
'extensions'   =>  [
    "Test" => \Extensions\Test\Test::class,
],
```

Как можно заметить выше, в ключе мы указали название нашего расширения через которое мы и будем обращаться к нему.

<a name="Инициализируемые-расширения"></a>
### Инициализируемые расширения

Помимо обычных расширений есть возможность создать расширение которое будет создаваться перед инициализацией работы
приложения, это нужно для того что бы напримеро указать маршруты для работы расширения или например подгрузить шаблоны.

Для создания инциализируемого расширения нужно изменить реализуемый класс с `Extensionable` на `BootExtensionable`.
После этого стоит добавить новый метод `bootstrap`, в который будет передан экземпляр класса `Application`. В этом методе вы должны
инициализировать ваше расширение и сделать необходимые операции для его дальнейшей работы.

```php
<?php

namespace Extensions\Test;

use MyUCP\Extension\BootExtension;

class Test extends BootExtension
{
    public function bootstrap(\Application $app)
    {
        Router::any('/test', function() {
            return "Is it test extension..."; 
        });
    }

    public function run(...$args)
    {
        //
    }
}
```

После инициализации приложения маршрут с адресом `/test` выведет нам сообщение `Is it test extenion...`

<a name="Вызов-расширения"></a>
## Вызов расширения

Для вызова расширения вы можете использовать метод `run()` класса `MyUCP\Extenions\Extension`, первым аргументом
которого есть название вызываемого расширения, все следующие аргументы будут переданы в конструктор создаваемого расширения.

```php
app(\MyUCP\Extenions\Extension::class)->run('Test');
app('extension')->run('Test'); // Использование алиаса в контейнере
```

Так же вы можете использьзовать функцию помощник <a href="/docs/5.7/helpers#extension">`extension()`</a> для вызова расширения,
оно идентично методу `run()`.

Метод `run()` возвращает экземпляр класса расширения, и вы можете полностью использовать далее все его методы.
Этот метод так-же вызывает метод `run()` у расширения.

> Если вы ранее вызвали расширение или расширение инициализируемое, то метод вернет объект класса расширения для работы с ним.

<a name="Пересоздание-расширения"></a>
### Пересоздание расширения

Если вы уже инициализировали расширение, вы можете пересоздать его при помощи метода `reRun()`,
он принимает такие-же аргументы как и метод `run()`, но удаляет старый объект расширения из своего стэка, и создает новый.

```php
app('extension')->reRun('Test');
```

<a name="Методы-помощники"></a>
## Методы помощники

При создании класса расширения, мы наследовали наш класс от `BaseExtension`, который в свою очередь наследует 
`ExtensionHelpers`.

`ExtensionHelpers` включает в себя методы которые могут помочь вам при создании расширения.

Метод `path()` поможет вам указать путь к нужному вам файлу относительно директории расширения (а именно класса расширения, 
который и наследует данный класс). В качестве аргумента вы можете передать название файла и директории для генерации адреса.

```php
$this->path('routes.php'); // extensions/Auth/routes.php
```

Метод `view()` поможет вам предзагрузить шаблон, он заменяет коснтрукцию `View::preLoad()` и принимает таки-же аргументы. Подробнее можно узнать в разделе <a href="/docs/5.7/views#Предзагрузка-шаблонов">шаблоны</a>.

```php
$this->view('welcome', app()->assetPath('welcome.html'));
```

Метод `controller()` поможет вам так же предзагрузить контроллер или указать алиас, он идентичен метод `Controller::alias()`.
Подробнее о предзагрузке контроллера можно прочитать в разделе <a href="/docs/5.7/controllers#Предзагрузка-контроллера">контроллер</a>
