# Работа с базой данных

- [Введение](#Введение)
- [Отправка SQL запросов](#Отправка-SQL-запросов)
- [Функции для работы с базой данных](#Функции-для-работы-с-базой-данных)

<a name="Введение"></a>
## Введение

Для подключения к базе данных служат данные которые указаны в главном конфиге. Как правильно настроить главный конфиг можно посмотреть <a href="/docs/5.5/configs">тут</a>.

Поле указания данных в конфиге и начала работы вашего сайта, подключение к базе данных происходит автоматически.

> Начиная с версии <a href="https://github.com/maksa988/MyUCP/releases/tag/v5.3.1">5.3.1</a> для работы с базой данных был добавлен конструктор запросов. <a href="/docs/5.5/builder">Подробнее</a>

<a name="Отправка-SQL-запросов"></a>
## Отправка SQL запросов

Для работы с базой данных используется объект базы данных `db`. Обращение к базе данных может происходить в любом файле. Для отправки запросов нам необходима одна функция `query()`.

### Пример отправки запроса:

```php
$result = $this->db->query("SELECT * FROM `table`")
```

В переменную `$result` будет возвращен массив со списком записей из таблицы `table`

<hr>

<a name="Функции-для-работы-с-базой-данных"></a>
## Функции для работы с базой данных

Для работы с базой данных были созданы специальные функции которые помогут вам обращаться к базе данных получая нужный вам результат.

Функция для получения количества затронутых строк
```php
affectedRows()
```

<hr>

Функция для получения ID последней вставки
```php
insertId()
```

<hr>

Возвращает количество рядов результата запроса
```php
numRows()
```

<hr>

Возвращает количество рядов результата запроса
```php
numRows(resource $result)
```

<hr>

Воспомагательная функция пользовает получить значение одного поля с аргументами
```php
getOne()
```

Примеры:

```php
$name = $this->db->getOne("SELECT name FROM table WHERE id=1");
$name = $this->db->getOne("SELECT name FROM table WHERE id=?i", $id);
```

<hr>

Воспомагательная функция что бы получить одну строку с параметрами
```php
getRow()
```

Примеры:

```php
$data = $this->db->getRow("SELECT * FROM table WHERE id=1");
$data = $this->db->getOne("SELECT * FROM table WHERE id=?i", $id);
```

<hr>

Воспомагательная функция для получения одного столбца с параметрами
```php
getCol()
```

Примеры:

```php
$ids = $this->db->getCol("SELECT id FROM table WHERE cat=1");
$ids = $this->db->getCol("SELECT id FROM tags WHERE tagname = ?s", $tag);
```

<hr>

Воспомагательная функция для получения всех строк которые выдаст запрос
```php
getAll()
```

Примеры:

```php
$data = $this->db->getAll("SELECT * FROM table");
$data = $this->db->getAll("SELECT * FROM table LIMIT ?i,?i", $start, $rows);
```

<hr>

Функция ползволяет подготовить запрос раннее и вставить его в основной
```php
parse()
```

Примеры:

```php
$query = $this->db->parse("SELECT * FROM table WHERE foo=?s AND bar=?s", $foo, $bar);
echo $query;

$qpart = $this->db->parse(" AND foo=?s", $foo");
$data = $this->db->getAll("SELECT * FROM table WHERE bar=?s ?p", $bar, $qpart);
```

<hr>

Функция для получения статистики выполненного запроса
```php
getStats()
```

<hr>

Функция для написания своих SQL запросов и передачи их в <a href="/docs/5.5/builder">конструктор</a>
```php
raw()
```

<hr>

Функция для обьеденения строк в одну и передачи их в <a href="/docs/5.5/builder">конструктор</a>
```php
concat()
```

<hr>