# CSRF защита

- [Вступление](#Вступление)
- [Проверка токена](#Проверка-токена)
- [Получение токена](#Получение-токена)


<a name="Вступление"></a>
## Вступление

В MyUCP встроена защита от <a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%B6%D1%81%D0%B0%D0%B9%D1%82%D0%BE%D0%B2%D0%B0%D1%8F_%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D0%BB%D0%BA%D0%B0_%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%B0">межсайтовай подделки запроса (csrf)</a>.
вид атак на посетителей веб-сайтов, использующий недостатки протокола HTTP. Если жертва заходит на сайт, созданный злоумышленником, от её лица тайно отправляется запрос на другой сервер.

Для защиты используется специальный "токен" который хранится в активной сессии пользователя. Он используется для идентефикации авторизированного пользователя.

Если для маршрута включена <a href="/5.7/routing#csrf">CSRF защита</a>, тогда при обращении к нему стоит передавать скрытое поле с токеном:

```php
<form method="POST" action="/profile">
    @csrf_field()
    ...
</form>
```

<a name="Проверка-токена"></a>
## Проверка токена

Если вы хотите что бы к конкретному адреса была задействована <a href="/5.7/routing#csrf">CSRF защита</a>, при создании маршрута стоит использовать метод `csrfVerify()`,
тем самым вы укажете что при обращении на этот адрес нужно производить проверку токена.

```php
Router::any('/logout', 'UserController@logout')->csrfVerify();
```

Если вам не обязательно проверять при обращении к маршруту, а где то в середине кода, после определенных действий или проверок,
вы можете вызвать объект `CsrfToken` и при помощи метода `check()` осуществить проверку. Метод возвращает логическое значение проверки `true` если токен валидный и совпадает
и `false` если токен не найден или не совпадает с токеном пользователя.

```php
if(app('csrftoken')->check()) {
    //
}
```

<a name="Получение-токена"></a>
## Получение токена

Если вы хотите вставить токен в скрытое поле или адрес, вы можете использовать доступ к объекту `CsrfToken`
и при помощи метода `token()` получить текущий токен пользователя.

Или вы можете использовать функци-помощник `csrf_token()`:

```php
$token = app("csrftoken")->token();
$token = csrf_token();
```

Если вы используете шаблонизатор <a href="/5.7/zara">Zara</a> то вы можете использовать директивы `@csrf_token()` и `@csrf_field()`.
Первая директива вернет токен, вторая же директива вернет готовое скрытое поле с подставленным токеном:

```php
<form method="POST" action="/profile">
    @csrf_field()
    ...
    <input type="hidden" name="_token" value="@csrf_token()">
    ...
</form>
```