# Шаблонизатор Zara

- [Введение](#Введение)
- [Создание шаблона Zara](#Создание-шаблона-Zara)
- [Использование шаблона Zara](#Использование-шаблона-Zara)
- [Внедрение классов](#Внедрение-классов)
- [Другие директивы Zara](#Другие-директивы-Zara)
    - [Вывод переменных](#Вывод-переменных)
    - [Вывод переменных после проверки на существование](#Вывод-переменных-после-проверки-на-существование)
    - [Вывод сырого текста в фигурных скобках](#Вывод-сырого-текста-в-фигурных-скобках)
    - [Директива If](#Директива-If)
    - [Циклы](#Циклы)
    - [Включение подшаблонов](#Включение-подшаблонов)
    - [Перезапись секций](#Перезапись-секций)
    - [Комментарии](#Комментарии)
    - [Собственные директивы](#Собственные-директивы)

<a name="Введение"></a>
## Введение

Zara — простой, но мощный шаблонизатор, входящий в состав MyUCP. В отличии от шаблонов контроллеров, Zara основан на концепции наследования шаблонов и секциях. Все шаблоны Zara должны иметь расширение .zara.php.

Zara был написан по принципу работы шаблонизатора Blade.

<a name="Создание-шаблона-Zara"></a>
## Создание шаблона Zara

Расположен в `theme/test.zara.php`

```php
<html>
  <head>
    <title>App Name - @yield('title')</title>
  </head>
  <body>
    @section('sidebar')
      Это - главная боковая панель.
    @show

    <div class="container">    	
	@yield('content')
    </div>
  </body>
</html>
```

<a name="Использование-шаблона-Zara"></a>
## Использование шаблона Zara

```php
@extends('layouts.master')
@section('title', 'Page Title')
@section('sidebar')

@раrent
  Этот элемент будет добавлен к главной боковой панели.
@stop

@section('content')
  Это - содержимое страницы.
@stop
```

Заметьте, что шаблоны, которые расширяют другой Zara-шаблон с помощью `@extends`, просто перекрывают его секции. Старое (перекрытое) содержимое может быть выведено директивой `@parent`, что позволяет добавлять содержимое в такие секции, как боковая панель или «подвал».

Иногда — например, когда вы не уверены, что секция была определена — вам может понадобиться указать значение по умолчанию для директивы `@yield`. Вы можете передать его вторым аргументом:
    
```php
@yield('section', 'Default Content')
```

<a name="Внедрение классов"></a>
## Внедрение классов 

Вы можете вставить в шаблон любой класс, который определён в сервис-контейнере фреймворка. Для этого используется директива `@inject`, первый аргумент которой - название переменной, в которую будет помещён экземпляр класса, а второй - название внедряемого класса или интерфейса:

```php
@inject('metrics', 'Metrics')

<div>
    Monthly Revenue: {{ $metrics->monthlyRevenue() }}.
</div>
```

<a name="Другие-директивы-Zara"></a>
## Другие директивы Zara 

<a name="Вывод-переменных"></a>
### Вывод переменных 

```php
Hello, {{ $name }}.

The current UNIX timestamp is {{ time() }}.
```

<a name="Вывод-переменных-после-проверки-на-существование"></a>
### Вывод переменных после проверки на существование 

Иногда вам надо вывести значение переменной, но вы не уверены, задано ли оно. То есть вы хотите сделать так:

```php
{{ isset($name) ? $name : 'Default' }}
```

Вместо написания тернарного оператора, Zara позволяет вам использовать такое удобное сокращение:

```php
{{ $name or 'Default' }}
```

<a name="Вывод-сырого-текста-в-фигурных-скобках"></a>
### Вывод сырого текста в фигурных скобках 

Если вам нужно вывести строку в фигурных скобках, вы можете отменить её обработку с помощью Zara, поставив перед текстом символ @:

```php
@{{ Это не будет обработано с помощью Zara }}
```

Если вы не хотите экранировать данные, используйте такой синтаксис:

```php
Hello, {!! $name !!}.
```

> Внимание: будьте очень осторожны и экранируйте переменные, которые содержат ввод от пользователя. Всегда используйте двойные скобки, чтобы экранировать все HTML-сущности.

<a name="Директива-If"></a>
### Директива If 

```php
@if (count($records) === 1)
  Здесь есть одна запись!
@elseif (count($records) > 1)
  Здесь есть много записей!
@else
  Здесь нет записей!
@endif
```

<a name="Циклы"></a>
### Циклы 

```php
@for ($i = 0; $i < 10; $i++)
  Текущее значение: {{ $i }}
@endfor

@foreach ($users as $user)
  Это пользователь {{ $user->id }}
@endforeach

@forelse($users as $user)
  <li>{{ $user->name }}</li>
@empty
  Нет пользователей
@endforelse

@while (true)
  Это будет длиться вечно.
@endwhile
```

<a name="Включение-подшаблонов"></a>
### Включение подшаблонов

Zara дает возможность включать шаблоны в другие шаблоны при помощи директивы `@include`. Все переменные, доступны родительскому шаблону,
буду доступны и включаемому шаблону:

```
view('welcome', ['hello' => 'world'])

// welcome.zara.php

<div>
    @include('hello')
</div>

// hello.zara.php

{{ $hello }}

// Результат:

<div>
    world
</div>
```

Хотя включаемый шаблон унаследует все данные, доступные родительскому шаблону, вы также можете передать в него массив дополнительных данных:

```php
@include('view-name', ['some' => 'data])
```

Так же вы можете использовать метод `include` у класса `Zara` который будет идентичен директиве:

```php
Zara::include('view-name', ['hello' => 'world'])
```

<a name="Перезапись-секций"></a>
### Перезапись секций 

Для полной перезаписи можно использовать директиву @overwrite:

```php
@extends('list.item.container')

@section('list.item.content')
  Это - элемент типа {{ $item->type }}
@overwrite
```

<a name="Комментарии"></a>
### Комментарии 

```php
{{-- Этот комментарий не будет включён в сгенерированный HTML --}}
```


<a name="Собственные-директивы"></a>
### Собственные директивы

Вы можете создать свою директиву которую можете использовать в шаблонах Zara.

Например вам нужно вывести время в нужно вам формате, для этого в файле `app/services/ZaraService.php`
в конструкторе создайте новую директивую используя статический метод `directive`.
Например название нашей директивы будет `@datetime($var)`, и `$var` должно быть
объектом класа `DateTime`

```php
<?php

class ZaraService
{
    public function __construct($viewName)
    {
        Zara::directive("datetime", function($expression) {
            return "<?php echo ($expression)->format('m/d/Y H:i'); ?>";
        });
    }
}
```

#### Условные директивы

Если вам нужно создать свою условную директиву, вы можете использовать статический метод `Zara::if`,
первым аргументом указав название директивы, а вторым уже создать callback-функцию где будет описана
её логика.

Создание условных директив происходит так же в файле `app/services/ZaraService.php`
в конструкторе класса `ZaraService`

```php
<?php

class ZaraService
{
    public function __construct(string $viewName)
    {
        Zara::if('language', function ($lang) {
            return Lang::currentLocale() == $lang;
        });
    }
}
```

Теперь в вашем шаблоне вы можете использовать эту директиву следующим образом:

```php
@language('ru')
    // Язык русский...
@elselanguage('en')
    // Язык английский...
@else
    // Другой язык...
@endlanguage
```
